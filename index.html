<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prontu√°rio Psicol√≥gico ‚Äî Dashboard</title>
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/pt-br.js"></script>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <style>
    :root{
      --sidebar-bg:#f8f9fa;
      --accent: linear-gradient(90deg,#6d28d9,#4f46e5);
      --panel-bg:#ffffff;
      --surface:#f1f3f5;
      --card:#ffffff;
      --muted:#64748b;
      --text-dark:#1e293b;
      --white:#ffffff;
      --border:#e2e8f0;
      --success:#10b981;
      --warning:#f59e0b;
      --danger:#ef4444;
      --info:#3b82f6;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Poppins',sans-serif;background:#f1f5f9;color:var(--text-dark);-webkit-font-smoothing:antialiased}
    .app {
      display:flex;
      height:100vh;
      width:100%;
      overflow:hidden;
    }
    /* Sidebar */
    .sidebar {
      width:260px;
      min-width:220px;
      background: linear-gradient(180deg,#ffffff 0%, #f8f9fa 100%);
      color:var(--text-dark);
      padding:22px 16px;
      display:flex;
      flex-direction:column;
      gap:18px;
      border-right:1px solid var(--border);
      box-shadow: 2px 0 8px rgba(0,0,0,0.04);
    }
    .brand {
      display:flex;
      align-items:center;
      gap:12px;
      padding-bottom:8px;
      margin-bottom:4px;
      border-bottom:1px solid var(--border);
    }
    .brand .logo {
      width:44px;height:44px;border-radius:10px;
      background:linear-gradient(135deg,#6d28d9,#4f46e5);
      display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:0 6px 18px rgba(79,70,229,0.18);
      color:#fff;
    }
    .brand h3{margin:0;font-size:15px;font-weight:600;color:var(--text-dark)}
    .brand p{margin:0;font-size:12px;color:var(--muted)}
    /* Nav */
    .nav {
      display:flex;flex-direction:column;gap:8px;margin-top:6px;
    }
    .nav button {
      display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;border:none;background:transparent;color:var(--text-dark);cursor:pointer;text-align:left;font-weight:500;
      transition: all .18s ease;
    }
    .nav button:hover { background: rgba(109,40,217,0.08); transform: translateY(-2px); }
    .nav button.active {
      background: linear-gradient(90deg,rgba(109,40,217,0.1) 0%, rgba(79,70,229,0.08) 100%);
      box-shadow: 0 4px 12px rgba(79,70,229,0.1);
      transform: none;
      color:#6d28d9;
    }
    .nav .material-icons { font-size:20px;color: #6d28d9 }
    .sidebar-footer { margin-top:auto; display:flex;flex-direction:column;gap:8px }
    .small-btn { padding:8px 10px; border-radius:8px; border:none; background:transparent; color:var(--muted); cursor:pointer; display:flex; align-items:center; gap:8px }
    .small-btn:hover { color:var(--text-dark); background: rgba(109,40,217,0.05) }
    /* Top header */
    .topbar {
      height:64px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:0 20px;
      border-bottom:1px solid var(--border);
      background: #ffffff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .top-left {display:flex;align-items:center;gap:12px}
    .page-title { font-size:18px; font-weight:600; color:var(--text-dark) }
    .user-actions { display:flex; align-items:center; gap:12px }
    .avatar {
      width:40px;height:40px;border-radius:10px;background:linear-gradient(90deg,#6d28d9,#4f46e5);display:flex;align-items:center;justify-content:center;font-weight:600;color:#fff;
      box-shadow:0 6px 18px rgba(79,70,229,0.15)
    }
    /* Workspace */
    .workspace {
      flex:1;
      display:flex;
      flex-direction:column;
      min-width:0;
      background: #f1f5f9;
    }
    .main-area {
      padding:20px;
      height:calc(100vh - 64px);
      overflow:auto;
    }
    .card {
      background: #ffffff;
      border-radius:12px;
      padding:20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      border: 1px solid var(--border);
    }
    /* Grid */
    .grid {
      display:grid;
      gap:18px;
    }
    .grid.cols-2 { grid-template-columns: 1fr 380px; }
    .grid.cols-1 { grid-template-columns: 1fr; }
    /* Form fields */
    label{ display:block; font-size:13px; color:var(--muted); margin-top:12px; font-weight:600 }
    input, select, textarea {
      width:100%; padding:10px 12px; margin-top:6px; background:#fff; border:1px solid var(--border); color:var(--text-dark); border-radius:8px;
    }
    input:focus, select:focus, textarea:focus {
      outline:none;
      border-color:#6d28d9;
      box-shadow: 0 0 0 3px rgba(109,40,217,0.1);
    }
    textarea { min-height:110px; resize:vertical }
    textarea:read-only { background: #f8f9fa; cursor: not-allowed; opacity: 0.7; }
    .btn {
      display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:600;
      transition: all 0.2s ease;
    }
    .btn.primary {
      background: linear-gradient(90deg,#6d28d9,#4f46e5); color:#fff; box-shadow: 0 4px 12px rgba(79,70,229,0.2);
    }
    .btn.ghost { background: transparent; color:var(--muted); border:1px solid var(--border) }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(79,70,229,0.25); }
    .btn.toggle-btn {
      background: #f8f9fa;
      color: var(--text-dark);
      border: 1px solid var(--border);
    }
    .btn.toggle-btn.active {
      background: linear-gradient(90deg,#6d28d9,#4f46e5);
      color: #fff;
      border: 1px solid transparent;
    }
    .actions { display:flex; gap:10px; align-items:center; margin-bottom:12px; flex-wrap: wrap; }
    .session-card {
      background: #f8f9fa;
      padding:12px;
      border-radius:8px;
      border-left:4px solid #6d28d9;
      margin-bottom:12px;
      color:var(--text-dark);
      font-size: 13px;
      line-height: 1.6;
    }
    .historico-preview {
      background: rgba(109, 40, 217, 0.05);
      border: 1px solid rgba(109, 40, 217, 0.2);
      border-radius: 8px;
      padding: 12px;
      margin-top: 12px;
      max-height: 300px;
      overflow-y: auto;
    }
    .historico-preview .historico-item {
      padding: 8px;
      margin-bottom: 8px;
      background: #fff;
      border-radius: 6px;
      border-left: 3px solid #6d28d9;
    }
    .historico-preview .date {
      font-weight: 600;
      color: #6d28d9;
      font-size: 12px;
      margin-bottom: 4px;
    }
    .historico-preview .content {
      color: var(--muted);
      font-size: 13px;
    }
    /* Status badges */
    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
    }
    .status-compareceu { background: #d1fae5; color: #065f46; }
    .status-faltou { background: #fee2e2; color: #991b1b; }
    .status-reagendou { background: #fef3c7; color: #92400e; }
    .status-pago { background: #d1fae5; color: #065f46; }
    .status-pendente { background: #fee2e2; color: #991b1b; }
    /* Table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    th {
      background: #f8f9fa;
      font-weight: 600;
      color: var(--text-dark);
      font-size: 13px;
    }
    td {
      font-size: 14px;
      color: var(--text-dark);
    }
    tr:hover {
      background: #f8f9fa;
    }
    /* Stats cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }
    .stat-card {
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      border: 1px solid var(--border);
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
    }
    .stat-card .label {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .stat-card .value {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-dark);
    }
    .stat-card.success .value { color: var(--success); }
    .stat-card.danger .value { color: var(--danger); }
    .stat-card.warning .value { color: var(--warning); }
    .stat-card.info .value { color: var(--info); }
    /* Chart container */
    .chart-container {
      position: relative;
      height: 300px;
      margin-top: 20px;
    }
    /* Calendar */
    #calendar {
      margin-top: 20px;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    .fc-toolbar {
      padding: 10px;
    }
    .fc-button {
      background: linear-gradient(90deg,#6d28d9,#4f46e5) !important;
      border: none !important;
    }
    .fc-button:hover {
      opacity: 0.9;
    }
    .fc-event {
      background: linear-gradient(90deg,#6d28d9,#4f46e5) !important;
      border: none !important;
      padding: 4px 8px;
      border-radius: 6px;
    }
    /* Timeline */
    .timeline {
      position: relative;
      margin: 20px 0;
    }
    .timeline-item {
      position: relative;
      padding: 20px 0 20px 30px;
      border-left: 2px solid #6d28d9;
    }
    .timeline-item:before {
      content: '';
      position: absolute;
      left: -8px;
      top: 24px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #6d28d9;
    }
    .timeline-date {
      font-weight: 600;
      color: #6d28d9;
      margin-bottom: 8px;
    }
    .timeline-content {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #6d28d9;
    }
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    /* Responsive */
    @media (max-width:980px) {
      .sidebar { width:64px; min-width:64px; padding:12px }
      .brand h3, .brand p { display:none }
      .nav button span.label { display:none }
      .grid.cols-2 { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: 1fr; }
    }
    @media (max-width:640px) {
      .topbar { padding:8px 12px }
      .main-area { padding:12px }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="logo">PS</div>
        <div>
          <h3>Prontu√°rio</h3>
          <p>Clinica ‚Ä¢ Painel</p>
        </div>
      </div>
      <nav class="nav" role="navigation" aria-label="menu lateral">
        <button class="nav-btn active" data-tab="paciente" id="btn-paciente">
          <span class="material-icons">person</span>
          <span class="label">Paciente</span>
        </button>
        <button class="nav-btn" data-tab="sessao" id="btn-sessao">
          <span class="material-icons">forum</span>
          <span class="label">Sess√£o</span>
        </button>
        <button class="nav-btn" data-tab="agenda" id="btn-agenda">
          <span class="material-icons">event</span>
          <span class="label">Agenda</span>
        </button>
        <button class="nav-btn" data-tab="historico" id="btn-historico">
          <span class="material-icons">history</span>
          <span class="label">Hist√≥rico</span>
        </button>
        <button class="nav-btn" data-tab="evolucao" id="btn-evolucao">
          <span class="material-icons">trending_up</span>
          <span class="label">Evolu√ß√£o</span>
        </button>
        <button class="nav-btn" data-tab="frequencia" id="btn-frequencia">
          <span class="material-icons">analytics</span>
          <span class="label">Frequ√™ncia</span>
        </button>
        <button class="nav-btn" data-tab="financeiro" id="btn-financeiro">
          <span class="material-icons">payments</span>
          <span class="label">Financeiro</span>
        </button>
      </nav>
      <div class="sidebar-footer">
        <button class="small-btn" onclick="toggleSidebar()" title="Alternar menu">
          <span class="material-icons">menu</span> <span class="label">Toggle</span>
        </button>
        <div style="height:8px"></div>
        <div style="font-size:12px;color:var(--muted)"><strong>Conectado:</strong><div id="userEmail" style="margin-top:6px;color:var(--muted)"> ‚Äî </div></div>
      </div>
    </aside>
    <!-- WORKSPACE -->
    <div class="workspace">
      <div class="topbar" id="topbar" style="display:none">
        <div class="top-left">
          <div class="page-title" id="pageTitle">Paciente</div>
        </div>
        <div class="user-actions">
          <div id="userName" style="font-weight:600;color:var(--text-dark); margin-right:6px"></div>
          <div class="avatar" id="userAvatar">U</div>
          <button class="btn ghost" onclick="logoutGoogle()" title="Sair">
            <span class="material-icons">logout</span>
            <span>Sair</span>
          </button>
        </div>
      </div>
      <div class="main-area" id="mainArea">
        <div id="carregando" style="text-align:center;padding:30px;color:var(--muted)">Carregando...</div>
        <!-- LOGIN CARD -->
        <div id="loginCard" style="display:none">
          <div class="card">
            <h2>Bem-vindo</h2>
            <p style="color:var(--muted)">Fa√ßa login com Google para acessar o prontu√°rio.</p>
            <div style="margin-top:18px">
              <button class="btn primary" onclick="loginGoogle()">
                <span class="material-icons">login</span> Entrar com Google
              </button>
            </div>
          </div>
        </div>
        <!-- SISTEMA -->
        <div id="appContent" style="display:none">
          <!-- Paciente Tab -->
          <section id="paciente" class="card tab active">
            <h3>Cadastro de Paciente</h3>
            <div class="grid cols-2" style="margin-top:14px">
              <div>
                <form id="formPaciente">
                  <label>Nome</label>
                  <input type="text" name="nome" required />
                  <label>Idade</label>
                  <input type="number" name="idade" required />
                  <label>Contato</label>
                  <input type="text" name="contato" />
                  <label>Valor da Consulta (R$)</label>
                  <input type="number" name="valorConsulta" step="0.01" placeholder="150.00" />
                  <div style="margin-top:14px">
                    <button class="btn primary" type="submit"><span class="material-icons">person_add</span> Cadastrar</button>
                  </div>
                </form>
              </div>
              <div>
                <div class="card" style="padding:14px;background:#f8f9fa">
                  <strong style="color:var(--muted)">Dica r√°pida</strong>
                  <p style="margin-top:8px;color:var(--muted)">Use nomes completos para evitar duplicidade. O valor da consulta pode ser ajustado posteriormente na aba Financeiro.</p>
                </div>
              </div>
            </div>
          </section>
          <!-- Sess√£o Tab -->
          <section id="sessao" class="card tab" style="display:none">
            <h3>Registrar Sess√£o</h3>
            <div style="margin-top:14px; margin-bottom:20px;">
              <label style="margin-bottom:10px; display:block;">Tipo de Consulta</label>
              <div class="actions" style="margin:0;">
                <button type="button" class="btn toggle-btn active" id="btnPrimeiraConsulta" onclick="selecionarTipoConsulta('primeira')">
                  <span class="material-icons">person_add</span> Primeira Consulta
                </button>
                <button type="button" class="btn toggle-btn" id="btnAcompanhamento" onclick="selecionarTipoConsulta('acompanhamento')">
                  <span class="material-icons">update</span> Em Acompanhamento
                </button>
              </div>
              <p style="color:var(--muted); font-size:12px; margin-top:8px;" id="tipoConsultaInfo">
                Primeira consulta: hist√≥rico edit√°vel para novo paciente
              </p>
            </div>
            <div style="margin-top:10px">
              <form id="formSessao">
                <input type="hidden" name="tipoConsulta" id="tipoConsultaInput" value="primeira" />
                <label>Paciente</label>
                <select name="nome" id="nomeSessao" required></select>
                <label>Data da Consulta</label>
                <input type="date" name="dataConsulta" required />
                <label>Status da Consulta</label>
                <select name="statusConsulta" id="statusConsulta" required>
                  <option value="Compareceu">‚úÖ Compareceu</option>
                  <option value="Faltou">‚ùå Faltou</option>
                  <option value="Reagendou">üìÖ Reagendou</option>
                </select>
                <label>Status do Pagamento</label>
                <select name="statusPagamento" id="statusPagamento" required>
                  <option value="Pago">üí∞ Pago</option>
                  <option value="Pendente">‚è≥ Pendente</option>
                </select>
                <label>Hist√≥rico Psicol√≥gico</label>
                <textarea name="historico" id="historicoTextarea"></textarea>
                <div id="historicoPreview" style="display:none;">
                  <label style="margin-top:12px;">Hist√≥rico Anterior do Paciente</label>
                  <div class="historico-preview" id="historicoPreviewContent"></div>
                </div>
                <label>Evolu√ß√£o do Tratamento</label>
                <textarea name="evolucao"></textarea>
                <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
                  <button class="btn primary" type="submit"><span class="material-icons">save</span> Salvar Sess√£o</button>
                </div>
              </form>
            </div>
          </section>
          <!-- Agenda Tab -->
          <section id="agenda" class="card tab" style="display:none">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <h3>Agenda de Consultas</h3>
              <button class="btn primary" onclick="abrirModalAgenda()">
                <span class="material-icons">add</span> Nova Consulta
              </button>
            </div>
            <div id="calendar"></div>
          </section>
          <!-- Hist√≥rico Tab -->
          <section id="historico" class="card tab" style="display:none">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <h3>Hist√≥rico Completo</h3>
              <div style="color:var(--muted);font-size:13px">Visualize o hist√≥rico completo do paciente</div>
            </div>
            <div class="actions" style="margin-top:12px">
              <select id="historicoSelect" style="min-width:220px;padding:10px;border-radius:8px;background:#fff;border:1px solid var(--border);color:var(--text-dark)"></select>
              <button class="btn primary" onclick="verHistorico()"><span class="material-icons">search</span> Buscar Hist√≥rico</button>
              <button class="btn primary" onclick="exportarPDF()"><span class="material-icons">picture_as_pdf</span> Exportar PDF</button>
            </div>
            <div id="historicoConteudo" style="margin-top:12px"></div>
          </section>
          <!-- Evolu√ß√£o Tab -->
          <section id="evolucao" class="card tab" style="display:none">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <h3>Linha do Tempo - Evolu√ß√£o</h3>
              <div style="color:var(--muted);font-size:13px">Acompanhe a evolu√ß√£o do tratamento</div>
            </div>
            <div class="actions" style="margin-top:12px">
              <select id="evolucaoSelect" style="min-width:220px;padding:10px;border-radius:8px;background:#fff;border:1px solid var(--border);color:var(--text-dark)"></select>
              <button class="btn primary" onclick="verEvolucao()"><span class="material-icons">timeline</span> Ver Evolu√ß√£o</button>
            </div>
            <div id="evolucaoConteudo" class="timeline" style="margin-top:20px"></div>
          </section>
          <!-- Frequ√™ncia Tab -->
          <section id="frequencia" class="card tab" style="display:none">
            <h3>Frequ√™ncia de Consultas</h3>
            <div class="actions" style="margin-top:16px">
              <select id="frequenciaPaciente" style="min-width:220px;padding:10px;border-radius:8px;background:#fff;border:1px solid var(--border);color:var(--text-dark)">
                <option value="">Todos os pacientes</option>
              </select>
              <select id="frequenciaMes" style="min-width:150px;padding:10px;border-radius:8px;background:#fff;border:1px solid var(--border);color:var(--text-dark)">
                <option value="">Todos os meses</option>
                <option value="1">Janeiro</option>
                <option value="2">Fevereiro</option>
                <option value="3">Mar√ßo</option>
                <option value="4">Abril</option>
                <option value="5">Maio</option>
                <option value="6">Junho</option>
                <option value="7">Julho</option>
                <option value="8">Agosto</option>
                <option value="9">Setembro</option>
                <option value="10">Outubro</option>
                <option value="11">Novembro</option>
                <option value="12">Dezembro</option>
              </select>
              <select id="frequenciaAno" style="min-width:120px;padding:10px;border-radius:8px;background:#fff;border:1px solid var(--border);color:var(--text-dark)">
                <option value="">Todos os anos</option>
              </select>
              <button class="btn primary" onclick="atualizarFrequencia()">
                <span class="material-icons">filter_alt</span> Filtrar
              </button>
            </div>
            <div class="stats-grid" style="margin-top:20px">
              <div class="stat-card">
                <div class="label">Total de Consultas</div>
                <div class="value" id="statTotal">0</div>
              </div>
              <div class="stat-card success">
                <div class="label">Comparecimentos</div>
                <div class="value" id="statCompareceu">0</div>
              </div>
              <div class="stat-card danger">
                <div class="label">Faltas</div>
                <div class="value" id="statFaltou">0</div>
              </div>
              <div class="stat-card warning">
                <div class="label">Reagendamentos</div>
                <div class="value" id="statReagendou">0</div>
              </div>
            </div>
            <div class="card" style="margin-top:20px;padding:20px">
              <h4 style="margin-bottom:16px">Frequ√™ncia Mensal</h4>
              <div class="chart-container">
                <canvas id="frequenciaChart"></canvas>
              </div>
            </div>
            <div style="margin-top:20px">
              <h4 style="margin-bottom:12px">Resumo por Paciente</h4>
              <div style="overflow-x:auto">
                <table id="frequenciaResumoTable">
                  <thead>
                    <tr>
                      <th>Paciente</th>
                      <th>Total</th>
                      <th>Compareceu</th>
                      <th>Faltou</th>
                      <th>Reagendou</th>
                    </tr>
                  </thead>
                  <tbody id="frequenciaResumoBody">
                    <tr>
                      <td colspan="5" style="text-align:center;color:var(--muted)">Nenhum dado encontrado</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div style="margin-top:20px">
              <h4 style="margin-bottom:12px">Detalhamento de Consultas</h4>
              <div style="overflow-x:auto">
                <table id="frequenciaTable">
                  <thead>
                    <tr>
                      <th>Data</th>
                      <th>Paciente</th>
                      <th>Status</th>
                      <th>Tipo</th>
                    </tr>
                  </thead>
                  <tbody id="frequenciaTableBody">
                    <tr>
                      <td colspan="4" style="text-align:center;color:var(--muted)">Nenhuma consulta encontrada</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </section>
          <!-- Financeiro Tab -->
          <section id="financeiro" class="card tab" style="display:none">
            <h3>Gest√£o Financeira</h3>
            <!-- Configura√ß√£o de Valores -->
            <div class="card" style="margin-top:16px;background:#f8f9fa;padding:16px">
              <h4 style="margin-bottom:12px">Configura√ß√£o de Valores</h4>
              <form id="formValorConsulta">
                <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px">
                  <div>
                    <label>Valor Atual da Consulta (R$)</label>
                    <input type="number" id="valorAtual" step="0.01" placeholder="150.00" required />
                  </div>
                  <div>
                    <label>Novo Valor (Reajuste)</label>
                    <input type="number" id="novoValor" step="0.01" placeholder="180.00" />
                  </div>
                  <div style="display:flex;align-items:end">
                    <button class="btn primary" type="submit" style="width:100%">
                      <span class="material-icons">save</span> Salvar Valores
                    </button>
                  </div>
                </div>
              </form>
            </div>
            <!-- Filtros -->
            <div class="actions" style="margin-top:20px">
              <select id="financeiroPaciente" style="min-width:220px;padding:10px;border-radius:8px;background:#fff;border:1px solid var(--border);color:var(--text-dark)">
                <option value="">Todos os pacientes</option>
              </select>
              <select id="financeiroMes" style="min-width:150px;padding:10px;border-radius:8px;background:#fff;border:1px solid var(--border);color:var(--text-dark)">
                <option value="">Todos os meses</option>
                <option value="1">Janeiro</option>
                <option value="2">Fevereiro</option>
                <option value="3">Mar√ßo</option>
                <option value="4">Abril</option>
                <option value="5">Maio</option>
                <option value="6">Junho</option>
                <option value="7">Julho</option>
                <option value="8">Agosto</option>
                <option value="9">Setembro</option>
                <option value="10">Outubro</option>
                <option value="11">Novembro</option>
                <option value="12">Dezembro</option>
              </select>
              <select id="financeiroAno" style="min-width:120px;padding:10px;border-radius:8px;background:#fff;border:1px solid var(--border);color:var(--text-dark)">
                <option value="">Todos os anos</option>
              </select>
              <select id="financeiroStatus" style="min-width:150px;padding:10px;border-radius:8px;background:#fff;border:1px solid var(--border);color:var(--text-dark)">
                <option value="">Todos os status</option>
                <option value="Pago">Pago</option>
                <option value="Pendente">Pendente</option>
              </select>
              <button class="btn primary" onclick="atualizarFinanceiro()">
                <span class="material-icons">filter_alt</span> Filtrar
              </button>
            </div>
            <!-- Stats Cards -->
            <div class="stats-grid" style="margin-top:20px">
              <div class="stat-card success">
                <div class="label">Total Recebido</div>
                <div class="value" id="statRecebido">R$ 0,00</div>
              </div>
              <div class="stat-card danger">
                <div class="label">Total Pendente</div>
                <div class="value" id="statPendente">R$ 0,00</div>
              </div>
              <div class="stat-card info">
                <div class="label">Receita Total</div>
                <div class="value" id="statReceitaTotal">R$ 0,00</div>
              </div>
              <div class="stat-card">
                <div class="label">Consultas Pagas</div>
                <div class="value" id="statConsultasPagas">0</div>
              </div>
            </div>
            <!-- Gr√°fico -->
            <div class="card" style="margin-top:20px;padding:20px">
              <h4 style="margin-bottom:16px">Status de Pagamentos</h4>
              <div class="chart-container">
                <canvas id="financeiroChart"></canvas>
              </div>
            </div>
            <!-- Tabela -->
            <div style="margin-top:20px">
              <h4 style="margin-bottom:12px">Detalhamento Financeiro</h4>
              <div style="overflow-x:auto">
                <table id="financeiroTable">
                  <thead>
                    <tr>
                      <th>Data</th>
                      <th>Paciente</th>
                      <th>Valor</th>
                      <th>Status Pagamento</th>
                      <th>Status Consulta</th>
                      <th>A√ß√µes</th>
                    </tr>
                  </thead>
                  <tbody id="financeiroTableBody">
                    <tr>
                      <td colspan="6" style="text-align:center;color:var(--muted)">Nenhum registro encontrado</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para Nova Consulta na Agenda -->
  <div id="modalAgenda" class="modal">
    <div class="card" style="width:90%;max-width:500px;max-height:90vh;overflow:auto">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
        <h3>Nova Consulta</h3>
        <button class="btn ghost" onclick="fecharModalAgenda()">
          <span class="material-icons">close</span>
        </button>
      </div>
      <form id="formAgenda">
        <label>Paciente</label>
        <select name="nome" id="nomeAgenda" required>
          <option value="">Selecione um paciente</option>
        </select>
        <label>Data da Consulta</label>
        <input type="datetime-local" name="dataConsulta" required />
        <label>Dura√ß√£o (minutos)</label>
        <input type="number" name="duracao" value="50" min="30" max="120" required />
        <label>Observa√ß√µes</label>
        <textarea name="observacoes" placeholder="Observa√ß√µes sobre a consulta..."></textarea>
        <div style="margin-top:20px;display:flex;gap:10px;justify-content:flex-end">
          <button type="button" class="btn ghost" onclick="fecharModalAgenda()">Cancelar</button>
          <button type="submit" class="btn primary">Agendar</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Configura√ß√£o do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCznEr8M2lNu7nwCfGN_kcJZFM5lqRQdf8",
      authDomain: "psico-17375.firebaseapp.com",
      projectId: "psico-17375",
      storageBucket: "psico-17375.appspot.com",
      messagingSenderId: "405718265829",
      appId: "1:405718265829:web:3e3974a0dc02080824890c",
      measurementId: "G-P19R4LJJKS"
    };
    
    // Inicializa√ß√£o do Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    
    // URL do Google Apps Script
    const scriptURL = "https://script.google.com/macros/s/AKfycbwHP641yvS4sxgrJwt6yN3vopBvD5UqmrZzyFdF59TZez54XB6HVmTSSDJJrZFqgank/exec";
    
    // Vari√°veis globais
    let calendar = null;
    let frequenciaChart = null;
    let financeiroChart = null;
    let valorConsultaAtual = 150.00;
    let tipoConsultaAtual = 'primeira';
    
    // Elementos DOM
    const topbar = document.getElementById('topbar');
    const pageTitle = document.getElementById('pageTitle');
    const mainArea = document.getElementById('mainArea');
    const carregando = document.getElementById('carregando');
    const loginCard = document.getElementById('loginCard');
    const appContent = document.getElementById('appContent');
    const modalAgenda = document.getElementById('modalAgenda');
    
    // Formul√°rios
    const formPaciente = document.getElementById('formPaciente');
    const formSessao = document.getElementById('formSessao');
    const formAgenda = document.getElementById('formAgenda');
    const formValorConsulta = document.getElementById('formValorConsulta');
    
    // Seletores
    const nomeSessao = document.getElementById('nomeSessao');
    const nomeAgenda = document.getElementById('nomeAgenda');
    const historicoSelect = document.getElementById('historicoSelect');
    const evolucaoSelect = document.getElementById('evolucaoSelect');
    const historicoTextarea = document.getElementById('historicoTextarea');
    const tipoConsultaInput = document.getElementById('tipoConsultaInput');
    
    // Pain√©is de conte√∫do
    const historicoConteudo = document.getElementById('historicoConteudo');
    const evolucaoConteudo = document.getElementById('evolucaoConteudo');
    const historicoPreview = document.getElementById('historicoPreview');
    const historicoPreviewContent = document.getElementById('historicoPreviewContent');
    
    // ========== FUN√á√ïES DE NAVEGA√á√ÉO ==========
    
    function setActiveNav(button) {
      document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
      button.classList.add('active');
    }
    
    function showTab(tabId) {
      // Esconde todas as abas
      document.querySelectorAll('.tab').forEach(tab => {
        tab.style.display = 'none';
        tab.classList.remove('active');
      });
      
      // Mostra a aba selecionada
      const tabEl = document.getElementById(tabId);
      if (tabEl) {
        tabEl.style.display = 'block';
        tabEl.classList.add('active');
      }
      
      // Atualiza o t√≠tulo da p√°gina
      const titulos = {
        'paciente': 'Paciente',
        'sessao': 'Sess√£o',
        'agenda': 'Agenda',
        'historico': 'Hist√≥rico',
        'evolucao': 'Evolu√ß√£o',
        'frequencia': 'Frequ√™ncia',
        'financeiro': 'Financeiro'
      };
      pageTitle.textContent = titulos[tabId] || tabId;
      
      // Inicializa componentes espec√≠ficos da aba
      if (tabId === 'frequencia') atualizarFrequencia();
      if (tabId === 'financeiro') atualizarFinanceiro();
      if (tabId === 'agenda') inicializarCalendario();
    }
    
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const isCollapsed = sidebar.style.width === '64px';
      
      sidebar.style.width = isCollapsed ? '260px' : '64px';
      
      // Mostra/oculta textos na sidebar
      document.querySelectorAll('.nav .label, .brand h3, .brand p').forEach(el => {
        el.style.display = isCollapsed ? 'block' : 'none';
      });
    }
    
    // ========== FUN√á√ïES DE AUTENTICA√á√ÉO ==========
    
    function loginGoogle() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .then((result) => {
          console.log('Login realizado com sucesso:', result.user);
        })
        .catch((error) => {
          console.error('Erro no login:', error);
          alert('Erro ao fazer login: ' + error.message);
        });
    }
    
    function logoutGoogle() {
      auth.signOut()
        .then(() => {
          alert('Logout realizado com sucesso');
        })
        .catch((error) => {
          console.error('Erro no logout:', error);
        });
    }
    
    // ========== FUN√á√ïES DE PACIENTES ==========
    
    async function atualizarListaDeNomes() {
      carregando.innerText = 'Carregando pacientes...';
      carregando.style.display = 'block';
      
      try {
        // Simula√ß√£o de dados - na implementa√ß√£o real, voc√™ faria uma requisi√ß√£o para o backend
        const pacientes = [
          { nome: 'Maria Silva', idade: 34, contato: '(11) 99999-1234' },
          { nome: 'Jo√£o Santos', idade: 42, contato: '(11) 98888-5678' },
          { nome: 'Carla Mendes', idade: 29, contato: '(11) 97777-9012' }
        ];
        
        // Limpa os selects
        const selects = [
          nomeSessao, nomeAgenda, historicoSelect, evolucaoSelect,
          document.getElementById('frequenciaPaciente'),
          document.getElementById('financeiroPaciente')
        ];
        
        selects.forEach(select => {
          select.innerHTML = '<option value="">Selecione um paciente</option>';
          if (select.id === 'frequenciaPaciente' || select.id === 'financeiroPaciente') {
            select.innerHTML = '<option value="">Todos os pacientes</option>';
          }
        });
        
        // Preenche os selects com os pacientes
        pacientes.forEach(paciente => {
          selects.forEach(select => {
            const option = document.createElement('option');
            option.value = paciente.nome;
            option.textContent = paciente.nome;
            select.appendChild(option);
          });
        });
        
      } catch (err) {
        console.error('Erro ao carregar pacientes:', err);
        alert('Erro ao carregar pacientes.');
      } finally {
        carregando.style.display = 'none';
      }
    }
    
    // ========== FUN√á√ïES DE SESS√ïES ==========
    
    function selecionarTipoConsulta(tipo) {
      tipoConsultaAtual = tipo;
      tipoConsultaInput.value = tipo;
      
      // Atualiza os bot√µes
      document.getElementById('btnPrimeiraConsulta').classList.toggle('active', tipo === 'primeira');
      document.getElementById('btnAcompanhamento').classList.toggle('active', tipo === 'acompanhamento');
      
      // Atualiza as informa√ß√µes
      const infoText = document.getElementById('tipoConsultaInfo');
      if (tipo === 'primeira') {
        infoText.textContent = 'Primeira consulta: hist√≥rico edit√°vel para novo paciente';
        historicoTextarea.readOnly = false;
        historicoTextarea.placeholder = 'Digite o hist√≥rico psicol√≥gico do paciente...';
        historicoPreview.style.display = 'none';
        historicoTextarea.value = '';
      } else {
        infoText.textContent = 'Em acompanhamento: hist√≥rico anterior ser√° carregado automaticamente';
        historicoTextarea.readOnly = true;
        historicoTextarea.placeholder = 'O hist√≥rico ser√° preenchido automaticamente ao selecionar o paciente';
        
        // Carrega o hist√≥rico se j√° tiver um paciente selecionado
        if (nomeSessao.value) {
          carregarHistoricoParaAcompanhamento(nomeSessao.value);
        }
      }
    }
    
    async function carregarHistoricoParaAcompanhamento(nome) {
      if (!nome || tipoConsultaAtual !== 'acompanhamento') return;
      
      try {
        // Simula√ß√£o de dados - na implementa√ß√£o real, voc√™ faria uma requisi√ß√£o para o backend
        const historico = [
          { dataConsulta: '2023-10-15', evolucao: 'Paciente relatou melhora nos sintomas de ansiedade ap√≥s as t√©cnicas de relaxamento.' },
          { dataConsulta: '2023-10-08', evolucao: 'Primeira sess√£o. Paciente apresentou sintomas de ansiedade generalizada.' }
        ];
        
        if (historico.length === 0) {
          historicoTextarea.value = 'Nenhum hist√≥rico anterior encontrado para este paciente.';
          historicoPreview.style.display = 'none';
          return;
        }
        
        // Preenche o textarea com o hist√≥rico
        let historicoCompleto = '=== HIST√ìRICO ANTERIOR DO PACIENTE ===\n\n';
        historico.forEach((sessao, index) => {
          historicoCompleto += `üìÖ ${sessao.dataConsulta}\n`;
          historicoCompleto += `${sessao.evolucao}\n`;
          if (index < historico.length - 1) {
            historicoCompleto += '\n---\n\n';
          }
        });
        
        historicoTextarea.value = historicoCompleto;
        historicoPreview.style.display = 'block';
        
        // Preenche o preview
        let previewHTML = '';
        historico.forEach(sessao => {
          previewHTML += `
            <div class="historico-item">
              <div class="date">üìÖ ${sessao.dataConsulta}</div>
              <div class="content">${sessao.evolucao}</div>
            </div>
          `;
        });
        historicoPreviewContent.innerHTML = previewHTML;
        
      } catch (err) {
        console.error('Erro ao carregar hist√≥rico:', err);
        historicoTextarea.value = 'Erro ao carregar hist√≥rico anterior.';
        historicoPreview.style.display = 'none';
      }
    }
    
    // ========== FUN√á√ïES DE AGENDA ==========
    
    function inicializarCalendario() {
      const calendarEl = document.getElementById('calendar');
      
      if (calendar) {
        calendar.destroy();
      }
      
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'pt-br',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: [
          {
            title: 'Maria Silva - Compareceu',
            start: '2023-11-15T09:00:00',
            end: '2023-11-15T10:00:00',
            backgroundColor: '#10b981',
            borderColor: '#10b981'
          },
          {
            title: 'Jo√£o Santos - Faltou',
            start: '2023-11-16T11:00:00',
            end: '2023-11-16T12:00:00',
            backgroundColor: '#ef4444',
            borderColor: '#ef4444'
          },
          {
            title: 'Carla Mendes - Reagendou',
            start: '2023-11-17T14:00:00',
            end: '2023-11-17T15:00:00',
            backgroundColor: '#f59e0b',
            borderColor: '#f59e0b'
          }
        ],
        eventClick: function(info) {
          alert(`Consulta: ${info.event.title}\nIn√≠cio: ${info.event.start.toLocaleString('pt-BR')}`);
        }
      });
      
      calendar.render();
    }
    
    function abrirModalAgenda() {
      modalAgenda.style.display = 'flex';
    }
    
    function fecharModalAgenda() {
      modalAgenda.style.display = 'none';
      formAgenda.reset();
    }
    
    // ========== FUN√á√ïES DE HIST√ìRICO E EVOLU√á√ÉO ==========
    
    async function verHistorico() {
      const nome = historicoSelect.value;
      if (!nome) {
        historicoConteudo.innerHTML = '<p style="color:var(--muted)">Selecione um paciente.</p>';
        return;
      }
      
      historicoConteudo.innerHTML = '<p style="color:var(--muted)">Buscando hist√≥rico...</p>';
      
      try {
        // Simula√ß√£o de dados - na implementa√ß√£o real, voc√™ faria uma requisi√ß√£o para o backend
        const sessoes = [
          {
            dataConsulta: '2023-11-15',
            statusConsulta: 'Compareceu',
            tipoConsulta: 'acompanhamento',
            historico: 'Paciente relatou melhora significativa nos sintomas ap√≥s implementa√ß√£o das t√©cnicas de mindfulness.',
            evolucao: 'Paciente demonstra maior consci√™ncia corporal e emocional. Relata redu√ß√£o da frequ√™ncia de crises de ansiedade.'
          },
          {
            dataConsulta: '2023-11-08',
            statusConsulta: 'Compareceu',
            tipoConsulta: 'acompanhamento',
            historico: 'Sess√£o focada em identifica√ß√£o de gatilhos ansiosos.',
            evolucao: 'Paciente come√ßou a reconhecer padr√µes de pensamento que desencadeiam ansiedade. Mostra-se motivado com o processo terap√™utico.'
          },
          {
            dataConsulta: '2023-11-01',
            statusConsulta: 'Compareceu',
            tipoConsulta: 'primeira',
            historico: 'Avalia√ß√£o inicial. Paciente relata hist√≥rico de ansiedade generalizada h√° 3 anos.',
            evolucao: 'Estabelecido rapport terap√™utico. Paciente parece engajado no processo. Planejamento: t√©cnicas de respira√ß√£o e mindfulness.'
          }
        ];
        
        if (sessoes.length === 0) {
          historicoConteudo.innerHTML = `<p style="color:var(--muted)">Nenhum hist√≥rico encontrado para ${nome}.</p>`;
          return;
        }
        
        let historicoHTML = '';
        sessoes.forEach(sessao => {
          const statusClass = sessao.statusConsulta.toLowerCase().replace(/\s/g, '');
          const tipo = sessao.tipoConsulta === 'primeira' ? 'Primeira Consulta' : 'Acompanhamento';
          
          historicoHTML += `
            <div class="session-card">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                <div style="font-weight:700;color:var(--text-dark)">üìÖ ${sessao.dataConsulta} - ${tipo}</div>
                <span class="status-badge status-${statusClass}">${sessao.statusConsulta}</span>
              </div>
              <div style="margin-top:6px;color:var(--muted)"><strong>Hist√≥rico:</strong> ${sessao.historico}</div>
              <div style="margin-top:6px;color:var(--muted)"><strong>Evolu√ß√£o:</strong> ${sessao.evolucao}</div>
            </div>
          `;
        });
        
        historicoConteudo.innerHTML = historicoHTML;
        
      } catch (err) {
        console.error('Erro ao buscar hist√≥rico:', err);
        historicoConteudo.innerHTML = `<p style="color:var(--muted)">Erro ao buscar hist√≥rico.</p>`;
      }
    }
    
    async function verEvolucao() {
      const nome = evolucaoSelect.value;
      if (!nome) {
        evolucaoConteudo.innerHTML = '<p style="color:var(--muted)">Selecione um paciente.</p>';
        return;
      }
      
      evolucaoConteudo.innerHTML = '<p style="color:var(--muted)">Buscando evolu√ß√£o...</p>';
      
      try {
        // Simula√ß√£o de dados - na implementa√ß√£o real, voc√™ faria uma requisi√ß√£o para o backend
        const sessoes = [
          {
            dataConsulta: '2023-11-15',
            statusConsulta: 'Compareceu',
            evolucao: 'Paciente demonstra maior consci√™ncia corporal e emocional. Relata redu√ß√£o da frequ√™ncia de crises de ansiedade.'
          },
          {
            dataConsulta: '2023-11-08',
            statusConsulta: 'Compareceu',
            evolucao: 'Paciente come√ßou a reconhecer padr√µes de pensamento que desencadeiam ansiedade. Mostra-se motivado com o processo terap√™utico.'
          },
          {
            dataConsulta: '2023-11-01',
            statusConsulta: 'Compareceu',
            evolucao: 'Estabelecido rapport terap√™utico. Paciente parece engajado no processo. Planejamento: t√©cnicas de respira√ß√£o e mindfulness.'
          }
        ];
        
        if (sessoes.length === 0) {
          evolucaoConteudo.innerHTML = `<p style="color:var(--muted)">Nenhuma sess√£o encontrada para ${nome}.</p>`;
          return;
        }
        
        // Ordena por data (mais recente primeiro)
        sessoes.sort((a, b) => new Date(b.dataConsulta) - new Date(a.dataConsulta));
        
        let timelineHTML = '';
        sessoes.forEach((sessao, index) => {
          const statusClass = sessao.statusConsulta.toLowerCase().replace(/\s/g, '');
          
          timelineHTML += `
            <div class="timeline-item">
              <div class="timeline-date">üìÖ ${sessao.dataConsulta} - Sess√£o ${sessoes.length - index}</div>
              <div class="timeline-content">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                  <strong>Status: <span class="status-badge status-${statusClass}">${sessao.statusConsulta}</span></strong>
                </div>
                <div><strong>Evolu√ß√£o:</strong> ${sessao.evolucao}</div>
              </div>
            </div>
          `;
        });
        
        evolucaoConteudo.innerHTML = timelineHTML;
        
      } catch (err) {
        console.error('Erro ao buscar evolu√ß√£o:', err);
        evolucaoConteudo.innerHTML = `<p style="color:var(--muted)">Erro ao buscar evolu√ß√£o.</p>`;
      }
    }
    
    function exportarPDF() {
      const nome = historicoSelect.value;
      if (!nome) {
        alert('Selecione um paciente para exportar.');
        return;
      }
      
      alert(`PDF gerado para ${nome}! (Funcionalidade de exporta√ß√£o em desenvolvimento)`);
    }
    
    // ========== FUN√á√ïES DE FREQU√äNCIA ==========
    
    function atualizarFrequencia() {
      // Simula√ß√£o de dados - na implementa√ß√£o real, voc√™ faria uma requisi√ß√£o para o backend
      const dados = {
        total: 12,
        compareceu: 8,
        faltou: 2,
        reagendou: 2
      };
      
      // Atualiza os cards de estat√≠sticas
      document.getElementById('statTotal').textContent = dados.total;
      document.getElementById('statCompareceu').textContent = dados.compareceu;
      document.getElementById('statFaltou').textContent = dados.faltou;
      document.getElementById('statReagendou').textContent = dados.reagendou;
      
      // Atualiza a tabela de resumo
      const resumoBody = document.getElementById('frequenciaResumoBody');
      resumoBody.innerHTML = `
        <tr>
          <td><strong>Maria Silva</strong></td>
          <td>5</td>
          <td><span class="status-badge status-compareceu">4</span></td>
          <td><span class="status-badge status-faltou">1</span></td>
          <td><span class="status-badge status-reagendou">0</span></td>
        </tr>
        <tr>
          <td><strong>Jo√£o Santos</strong></td>
          <td>4</td>
          <td><span class="status-badge status-compareceu">3</span></td>
          <td><span class="status-badge status-faltou">0</span></td>
          <td><span class="status-badge status-reagendou">1</span></td>
        </tr>
        <tr>
          <td><strong>Carla Mendes</strong></td>
          <td>3</td>
          <td><span class="status-badge status-compareceu">1</span></td>
          <td><span class="status-badge status-faltou">1</span></td>
          <td><span class="status-badge status-reagendou">1</span></td>
        </tr>
      `;
      
      // Atualiza a tabela de detalhes
      const tableBody = document.getElementById('frequenciaTableBody');
      tableBody.innerHTML = `
        <tr>
          <td>2023-11-15</td>
          <td>Maria Silva</td>
          <td><span class="status-badge status-compareceu">Compareceu</span></td>
          <td>Acompanhamento</td>
        </tr>
        <tr>
          <td>2023-11-16</td>
          <td>Jo√£o Santos</td>
          <td><span class="status-badge status-faltou">Faltou</span></td>
          <td>Acompanhamento</td>
        </tr>
        <tr>
          <td>2023-11-17</td>
          <td>Carla Mendes</td>
          <td><span class="status-badge status-reagendou">Reagendou</span></td>
          <td>Acompanhamento</td>
        </tr>
      `;
      
      // Atualiza o gr√°fico
      atualizarGraficoFrequencia();
    }
    
    function atualizarGraficoFrequencia() {
      const ctx = document.getElementById('frequenciaChart').getContext('2d');
      
      if (frequenciaChart) {
        frequenciaChart.destroy();
      }
      
      frequenciaChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
          datasets: [
            {
              label: 'Compareceu',
              data: [5, 4, 6, 7, 8, 5, 6, 7, 8, 6, 8, 9],
              backgroundColor: '#10b981'
            },
            {
              label: 'Faltou',
              data: [1, 2, 1, 0, 1, 2, 1, 0, 1, 2, 2, 1],
              backgroundColor: '#ef4444'
            },
            {
              label: 'Reagendou',
              data: [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 2, 0],
              backgroundColor: '#f59e0b'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });
    }
    
    // ========== FUN√á√ïES FINANCEIRAS ==========
    
    function atualizarFinanceiro() {
      // Simula√ß√£o de dados - na implementa√ß√£o real, voc√™ faria uma requisi√ß√£o para o backend
      const dados = {
        recebido: 1200.00,
        pendente: 450.00,
        receitaTotal: 1650.00,
        consultasPagas: 8
      };
      
      // Atualiza os cards de estat√≠sticas
      document.getElementById('statRecebido').textContent = `R$ ${dados.recebido.toFixed(2).replace('.', ',')}`;
      document.getElementById('statPendente').textContent = `R$ ${dados.pendente.toFixed(2).replace('.', ',')}`;
      document.getElementById('statReceitaTotal').textContent = `R$ ${dados.receitaTotal.toFixed(2).replace('.', ',')}`;
      document.getElementById('statConsultasPagas').textContent = dados.consultasPagas;
      
      // Atualiza a tabela
      const tableBody = document.getElementById('financeiroTableBody');
      tableBody.innerHTML = `
        <tr>
          <td>2023-11-15</td>
          <td>Maria Silva</td>
          <td>R$ 150,00</td>
          <td><span class="status-badge status-pago">Pago</span></td>
          <td><span class="status-badge status-compareceu">Compareceu</span></td>
          <td>
            <button class="btn ghost" style="padding:6px 10px;font-size:12px" onclick="alterarStatusPagamento('1', 'Maria Silva', '2023-11-15')">
              <span class="material-icons" style="font-size:16px">edit</span>
            </button>
          </td>
        </tr>
        <tr>
          <td>2023-11-16</td>
          <td>Jo√£o Santos</td>
          <td>R$ 150,00</td>
          <td><span class="status-badge status-pendente">Pendente</span></td>
          <td><span class="status-badge status-faltou">Faltou</span></td>
          <td>
            <button class="btn ghost" style="padding:6px 10px;font-size:12px" onclick="alterarStatusPagamento('2', 'Jo√£o Santos', '2023-11-16')">
              <span class="material-icons" style="font-size:16px">edit</span>
            </button>
          </td>
        </tr>
        <tr>
          <td>2023-11-17</td>
          <td>Carla Mendes</td>
          <td>R$ 150,00</td>
          <td><span class="status-badge status-pago">Pago</span></td>
          <td><span class="status-badge status-reagendou">Reagendou</span></td>
          <td>
            <button class="btn ghost" style="padding:6px 10px;font-size:12px" onclick="alterarStatusPagamento('3', 'Carla Mendes', '2023-11-17')">
              <span class="material-icons" style="font-size:16px">edit</span>
            </button>
          </td>
        </tr>
      `;
      
      // Atualiza o gr√°fico
      atualizarGraficoFinanceiro();
    }
    
    function atualizarGraficoFinanceiro() {
      const ctx = document.getElementById('financeiroChart').getContext('2d');
      
      if (financeiroChart) {
        financeiroChart.destroy();
      }
      
      financeiroChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Pago', 'Pendente'],
          datasets: [{
            data: [8, 3],
            backgroundColor: ['#10b981', '#ef4444'],
            borderColor: ['#059669', '#dc2626'],
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top'
            }
          }
        }
      });
    }
    
    function alterarStatusPagamento(id, nome, data) {
      alert(`Alterar status de pagamento:\nPaciente: ${nome}\nData: ${data}\nID: ${id}`);
    }
    
    // ========== FUN√á√ïES AUXILIARES ==========
    
    function preencherAnos() {
      const anoAtual = new Date().getFullYear();
      const selects = [
        document.getElementById('frequenciaAno'),
        document.getElementById('financeiroAno')
      ];
      
      selects.forEach(select => {
        for (let i = anoAtual; i >= anoAtual - 5; i--) {
          const option = document.createElement('option');
          option.value = i;
          option.textContent = i;
          select.appendChild(option);
        }
      });
    }
    
    // ========== EVENT LISTENERS ==========
    
    // Navega√ß√£o entre abas
    document.querySelectorAll('.nav button').forEach(btn => {
      btn.addEventListener('click', () => {
        const tabId = btn.getAttribute('data-tab');
        setActiveNav(btn);
        showTab(tabId);
      });
    });
    
    // Formul√°rio de paciente
    formPaciente.addEventListener('submit', (e) => {
      e.preventDefault();
      const formData = new FormData(formPaciente);
      const paciente = Object.fromEntries(formData);
      
      alert(`Paciente ${paciente.nome} cadastrado com sucesso!`);
      formPaciente.reset();
      atualizarListaDeNomes();
    });
    
    // Formul√°rio de sess√£o
    formSessao.addEventListener('submit', (e) => {
      e.preventDefault();
      const formData = new FormData(formSessao);
      const sessao = Object.fromEntries(formData);
      
      alert(`Sess√£o registrada com sucesso para ${sessao.nome}!`);
      formSessao.reset();
      selecionarTipoConsulta('primeira');
    });
    
    // Formul√°rio de agenda
    formAgenda.addEventListener('submit', (e) => {
      e.preventDefault();
      const formData = new FormData(formAgenda);
      const consulta = Object.fromEntries(formData);
      
      alert(`Consulta agendada com sucesso para ${consulta.nome}!`);
      fecharModalAgenda();
      
      // Atualiza o calend√°rio
      if (calendar) {
        calendar.refetchEvents();
      }
    });
    
    // Formul√°rio de valor de consulta
    formValorConsulta.addEventListener('submit', (e) => {
      e.preventDefault();
      const valorAtual = parseFloat(document.getElementById('valorAtual').value);
      const novoValor = parseFloat(document.getElementById('novoValor').value);
      
      if (valorAtual) {
        valorConsultaAtual = valorAtual;
        alert(`Valor da consulta atualizado para R$ ${valorAtual.toFixed(2)}`);
      }
      
      if (novoValor) {
        alert(`Novo valor de R$ ${novoValor.toFixed(2)} ser√° aplicado nas pr√≥ximas consultas.`);
      }
      
      atualizarFinanceiro();
    });
    
    // Change no select de paciente na sess√£o
    nomeSessao.addEventListener('change', function() {
      if (tipoConsultaAtual === 'acompanhamento') {
        carregarHistoricoParaAcompanhamento(this.value);
      }
    });
    
    // ========== INICIALIZA√á√ÉO ==========
    
    // Monitor de autentica√ß√£o
    auth.onAuthStateChanged(user => {
      carregando.style.display = 'none';
      
      if (user) {
        // Usu√°rio logado
        loginCard.style.display = 'none';
        appContent.style.display = 'block';
        topbar.style.display = 'flex';
        
        // Atualiza informa√ß√µes do usu√°rio
        document.getElementById('userEmail').textContent = user.email;
        document.getElementById('userName').textContent = user.displayName || 'Usu√°rio';
        
        const avatar = document.getElementById('userAvatar');
        if (user.photoURL) {
          avatar.style.backgroundImage = `url(${user.photoURL})`;
          avatar.textContent = '';
        } else {
          avatar.textContent = (user.displayName || 'U').charAt(0).toUpperCase();
        }
        
        // Inicializa dados
        atualizarListaDeNomes();
        preencherAnos();
        
        // Define a aba ativa inicial
        setActiveNav(document.getElementById('btn-paciente'));
        showTab('paciente');
        
      } else {
        // Usu√°rio n√£o logado
        loginCard.style.display = 'block';
        appContent.style.display = 'none';
        topbar.style.display = 'none';
        document.getElementById('userEmail').textContent = ' ‚Äî ';
      }
    });
    
    // Torna as fun√ß√µes dispon√≠veis globalmente
    window.loginGoogle = loginGoogle;
    window.logoutGoogle = logoutGoogle;
    window.toggleSidebar = toggleSidebar;
    window.selecionarTipoConsulta = selecionarTipoConsulta;
    window.abrirModalAgenda = abrirModalAgenda;
    window.fecharModalAgenda = fecharModalAgenda;
    window.verHistorico = verHistorico;
    window.verEvolucao = verEvolucao;
    window.exportarPDF = exportarPDF;
    window.atualizarFrequencia = atualizarFrequencia;
    window.atualizarFinanceiro = atualizarFinanceiro;
    window.alterarStatusPagamento = alterarStatusPagamento;
  </script>
</body>
</html>
