// Adicione esta função no final do <script>, antes de window.alterarStatusPagamento

async function alterarStatusPagamento(nome, data) {
  if (!nome || !data) {
    alert('Dados insuficientes para alterar o status.');
    return;
  }

  const novoStatus = prompt('Digite o novo status de pagamento:\n\n1 - Pago\n2 - Pendente\n\nDigite 1 ou 2:');

  let statusFinal = '';
  if (novoStatus === '1') {
    statusFinal = 'Pago';
  } else if (novoStatus === '2') {
    statusFinal = 'Pendente';
  } else {
    alert('Opção inválida. Use 1 para Pago ou 2 para Pendente.');
    return;
  }

  const confirma = confirm(`Alterar status de pagamento para "${statusFinal}"?\n\nPaciente: ${nome}\nData: ${data}`);
  if (!confirma) return;

  try {
    const fd = new FormData();
    fd.append('action', 'alterarStatusPagamento');
    fd.append('nome', nome);
    fd.append('dataConsulta', data);
    fd.append('novoStatus', statusFinal);

    const res = await fetch(scriptURL, { method: 'POST', body: fd });
    const result = await res.json();

    if (result.sucesso) {
      alert('Status de pagamento alterado com sucesso!');
      await atualizarFinanceiro();
    } else {
      throw new Error(result.erro || 'Erro ao alterar status');
    }
  } catch (err) {
    console.error('Erro ao alterar status:', err);
    alert('Erro ao alterar status de pagamento: ' + err.message);
  }
}

// Substitua a função alterarStatusPagamento existente por esta:
window.alterarStatusPagamento = alterarStatusPagamento;
